import{Q as se,O as F,P as le,z as S,a2 as ce,r as B,d as E,D as H,c as r,a3 as K,e as x,s as D,X as G,a0 as V,b as ie,A as Y,U as re,y as ue,a4 as de,F as fe,B as ve,m as _,a5 as me,a1 as ye,a6 as he,x as ke,N as ge,i as we,g as Ce}from"./index-8dde0f8b.js";import{u as Z,c as Oe}from"./use-expose-bd44a1ee.js";import{n as P,t as b,u as L,p as q,c as N,g as be,w as Q,b as I,H as Ie,I as W,z as Se}from"./index-a6b8ecb7.js";import{u as Pe,P as xe}from"./use-touch-90e10132.js";import{L as Te}from"./index-1e418958.js";let pe=2e3;const Be=()=>++pe,ze={show:Boolean,zIndex:P,overlay:b,duration:P,teleport:[String,Object],lockScroll:b,lazyRender:b,beforeClose:Function,overlayStyle:Object,overlayClass:L,transitionAppear:Boolean,closeOnClickOverlay:b};let T=0;const $="van-overflow-hidden";function Le(e,o){const t=Pe(),c="01",n="10",i=f=>{t.move(f);const l=t.deltaY.value>0?n:c,d=ce(f.target,e.value),{scrollHeight:h,offsetHeight:w,scrollTop:C}=d;let m="11";C===0?m=w>=h?"00":"01":C+w>=h&&(m="10"),m!=="11"&&t.isVertical()&&!(parseInt(m,2)&parseInt(l,2))&&q(f,!0)},a=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",i,{passive:!1}),T||document.body.classList.add($),T++},u=()=>{T&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",i),T--,T||document.body.classList.remove($))},y=()=>o()&&a(),v=()=>o()&&u();se(y),F(v),le(v),S(o,f=>{f?a():u()})}function X(e){const o=B(!1);return S(e,t=>{t&&(o.value=t)},{immediate:!0}),t=>()=>o.value?t():null}const[Ae,Ee]=N("overlay"),De={show:Boolean,zIndex:P,duration:P,className:L,lockScroll:b,lazyRender:b,customStyle:Object};var _e=E({name:Ae,props:De,setup(e,{slots:o}){const t=B(),c=X(()=>e.show||!e.lazyRender),n=a=>{e.lockScroll&&q(a,!0)},i=c(()=>{var a;const u=x(be(e.zIndex),e.customStyle);return D(e.duration)&&(u.animationDuration=`${e.duration}s`),G(r("div",{ref:t,style:u,class:[Ee(),e.className]},[(a=o.default)==null?void 0:a.call(o)]),[[V,e.show]])});return H("touchmove",n,{target:t}),()=>r(K,{name:"van-fade",appear:!0},{default:i})}});const Ne=Q(_e),Re=x({},ze,{round:Boolean,position:I("center"),closeIcon:I("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:I("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Me,U]=N("popup");var $e=E({name:Me,inheritAttrs:!1,props:Re,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:t,slots:c}){let n,i;const a=B(),u=B(),y=X(()=>e.show||!e.lazyRender),v=ie(()=>{const s={zIndex:a.value};if(D(e.duration)){const k=e.position==="center"?"animationDuration":"transitionDuration";s[k]=`${e.duration}s`}return s}),f=()=>{n||(n=!0,a.value=e.zIndex!==void 0?+e.zIndex:Be(),o("open"))},l=()=>{n&&Oe(e.beforeClose,{done(){n=!1,o("close"),o("update:show",!1)}})},d=s=>{o("clickOverlay",s),e.closeOnClickOverlay&&l()},h=()=>{if(e.overlay)return r(Ne,{show:e.show,class:e.overlayClass,zIndex:a.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:d},{default:c["overlay-content"]})},w=s=>{o("clickCloseIcon",s),l()},C=()=>{if(e.closeable)return r(W,{role:"button",tabindex:0,name:e.closeIcon,class:[U("close-icon",e.closeIconPosition),Ie],classPrefix:e.iconPrefix,onClick:w},null)};let m;const ee=()=>{m&&clearTimeout(m),m=setTimeout(()=>{o("opened")})},oe=()=>o("closed"),te=s=>o("keydown",s),ne=y(()=>{var s;const{round:k,position:z,safeAreaInsetTop:A,safeAreaInsetBottom:ae}=e;return G(r("div",_({ref:u,style:v.value,role:"dialog",tabindex:0,class:[U({round:k,[z]:z}),{"van-safe-area-top":A,"van-safe-area-bottom":ae}],onKeydown:te},t),[(s=c.default)==null?void 0:s.call(c),C()]),[[V,e.show]])}),M=()=>{const{position:s,transition:k,transitionAppear:z}=e,A=s==="center"?"van-fade":`van-popup-slide-${s}`;return r(K,{name:k||A,appear:z,onAfterEnter:ee,onAfterLeave:oe},{default:ne})};return S(()=>e.show,s=>{s&&!n&&(f(),t.tabindex===0&&ve(()=>{var k;(k=u.value)==null||k.focus()})),!s&&n&&(n=!1,o("close"))}),Z({popupRef:u}),Le(u,()=>e.show&&e.lockScroll),H("popstate",()=>{e.closeOnPopstate&&(l(),i=!1)}),Y(()=>{e.show&&f()}),re(()=>{i&&(o("update:show",!0),i=!1)}),F(()=>{e.show&&e.teleport&&(l(),i=!0)}),ue(xe,()=>e.show),()=>e.teleport?r(de,{to:e.teleport},{default:()=>[h(),M()]}):r(fe,null,[h(),M()])}});const Ue=Q($e);let p=0;function je(e){e?(p||document.body.classList.add("van-toast--unclickable"),p++):p&&(p--,p||document.body.classList.remove("van-toast--unclickable"))}const[Fe,O]=N("toast"),He=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay"],Ke={icon:String,show:Boolean,type:I("text"),overlay:Boolean,message:P,iconSize:P,duration:Se(2e3),position:I("middle"),teleport:[String,Object],wordBreak:String,className:L,iconPrefix:String,transition:I("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:L,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean};var Ge=E({name:Fe,props:Ke,emits:["update:show"],setup(e,{emit:o,slots:t}){let c,n=!1;const i=()=>{const l=e.show&&e.forbidClick;n!==l&&(n=l,je(n))},a=l=>o("update:show",l),u=()=>{e.closeOnClick&&a(!1)},y=()=>clearTimeout(c),v=()=>{const{icon:l,type:d,iconSize:h,iconPrefix:w,loadingType:C}=e;if(l||d==="success"||d==="fail")return r(W,{name:l||d,size:h,class:O("icon"),classPrefix:w},null);if(d==="loading")return r(Te,{class:O("loading"),size:h,type:C},null)},f=()=>{const{type:l,message:d}=e;if(t.message)return r("div",{class:O("text")},[t.message()]);if(D(d)&&d!=="")return l==="html"?r("div",{key:0,class:O("text"),innerHTML:String(d)},null):r("div",{class:O("text")},[d])};return S(()=>[e.show,e.forbidClick],i),S(()=>[e.show,e.type,e.message,e.duration],()=>{y(),e.show&&e.duration>0&&(c=setTimeout(()=>{a(!1)},e.duration))}),Y(i),me(i),()=>r(Ue,_({class:[O([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:u,onClosed:y,"onUpdate:show":a},ye(e,He)),{default:()=>[v(),f()]})}});function Ve(){const e=ke({show:!1}),o=n=>{e.show=n},t=n=>{x(e,n,{transitionAppear:!0}),o(!0)},c=()=>o(!1);return Z({open:t,close:c,toggle:o}),{open:t,close:c,state:e,toggle:o}}function Ye(e){const o=he(e),t=document.createElement("div");return document.body.appendChild(t),{instance:o.mount(t),unmount(){o.unmount(),document.body.removeChild(t)}}}const Ze={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let g=[],qe=!1,j=x({},Ze);const Qe=new Map;function J(e){return we(e)?e:{message:e}}function We(){const{instance:e,unmount:o}=Ye({setup(){const t=B(""),{open:c,state:n,close:i,toggle:a}=Ve(),u=()=>{},y=()=>r(Ge,_(n,{onClosed:u,"onUpdate:show":a}),null);return S(t,v=>{n.message=v}),Ce().render=y,{open:c,close:i,message:t}}});return e}function Xe(){if(!g.length||qe){const e=We();g.push(e)}return g[g.length-1]}function Je(e={}){if(!ge)return{};const o=Xe(),t=J(e);return o.open(x({},j,Qe.get(t.type||j.type),t)),o}const R=e=>o=>Je(x({type:e},J(o))),so=R("loading"),lo=R("success"),co=R("fail"),io=e=>{g.length&&(e?(g.forEach(o=>{o.close()}),g=[]):g[0].close())};export{Ue as P,Je as a,co as b,io as c,lo as d,Ge as e,so as s};
